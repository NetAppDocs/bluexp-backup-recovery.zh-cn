---
sidebar: sidebar 
permalink: task-deploy-snapcenter-plugin-for-sap-hana.html 
keywords: Cloud Manager, BlueXP, SnapCenter Plug-in for SAP HANA, SAP HANA, database, host, deploy 
summary: 在每个SAP HANA数据库主机上部署适用于SAP HNAN的SnapCenter 插件。 
---
= 部署适用于SAP HANA的SnapCenter 插件并添加数据库主机
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
您应在每个SAP HANA数据库主机上部署适用于SAP HANA的SnapCenter 插件。根据SAP HANA主机是否启用了基于SSH密钥的身份验证、您可以按照以下方法之一部署此插件。



== 前提条件

* 确保在每个SAP HANA数据库主机上都安装了Java 11 (64位) Oracle Java或OpenJDK。
* 您应已添加工作环境并创建Connector。
* 确保此连接器已连接到工作环境
* 确保BlueXP用户具有"帐户管理员"角色。
* 您应已创建SnapCenter 用户并为SnapCenter 用户配置sudo。有关信息、请参见 link:task-deploy-snapcenter-plugin-for-sap-hana.html#configure-sudo-for-snapcenter-user["为SnapCenter 用户配置sudo。"]
* 在添加数据库主机之前、您应已部署适用于SAP HANA的SnapCenter 插件。
* 在添加SAP HANA数据库主机时、您应添加HDB用户存储密钥。HDB安全用户存储密钥用于将SAP HANA数据库主机的连接信息安全存储在客户端上、而HDBSQL客户端使用安全用户存储密钥连接到SAP HANA数据库主机。
* 对于HANA系统复制(HSR)、要保护HANA系统、您应手动注册主HANA系统和二级HANA系统。
* 如果使用基于SSH的部署、则连接器应启用与SSH端口的通信(默认值：22)。
* 要使操作正常运行、连接器应启用与插件端口的通信(默认值为8145)。




== 为SnapCenter 用户配置sudo

您应创建一个SnapCenter 用户以部署此插件。

* 步骤 *

. 登录到Connector VM。
. 下载Linux主机插件二进制文件。
`sudo docker exec -it cloudmanager_scs_cloud curl -X GET 'http://127.0.0.1/deploy/downloadLinuxPlugin'`
. 获取基本挂载路径。`sUdo Docker volume ls | grep SCS_cloud _volume _查｛'print $2'｝_ xargs sudo Docker volume inspect _ grep mountpoint`
. 从复制第1行到第16行 `oracle_checksum_scs.txt` 文件位于 `base_mount_path/version/sc-linux-host-plugin/`
. 登录到SAP HANA数据库主机并执行以下步骤：
+
.. 创建SnapCenter 用户帐户、专用密钥对并分配权限。
.. 将步骤4中复制的行粘贴到 `/etc/sudoers` 使用visudo Linux实用程序创建文件。
+
在上述行中、将<LINUXUSER> 替换为您创建的SnapCenter 用户、并保存在visuod实用程序中。







== 使用基于SSH密钥的身份验证部署此插件

如果在HANA主机上启用了基于SSH密钥的身份验证、则可以执行以下步骤来部署此插件。在执行这些步骤之前、请确保已启用与连接器的SSH连接。

* 步骤 *

. 登录到Connector VM。
. 获取基本挂载路径。
`# sudo docker volume ls | grep scs_cloud_volume | awk {'print $2'} | xargs sudo docker volume inspect | grep Mountpoint`
. 部署此插件。
`# sudo <base_mount_path>/scripts/hana_plugin_copy_and_install.sh --host <host_name> --sshkey <ssh_key_file> --username <user_name> --port <ssh_port> --pluginport <plugin_port> --installdir <install_dir>`
+
** host_name是HANA主机的名称、这是一个必需参数。
** SSH_key_file是用于连接到HANA主机的SSH密钥、这是一个必需参数。
** user_name：在HANA主机上具有SSH权限的用户、这是一个可选参数。默认值为azureuser。
** SSH_port：HANA主机上的SSH端口、这是一个可选参数。默认值为22。
** plugin_port：插件使用的端口、这是一个可选参数。默认值为8145。
** install_dir：要部署此插件的目录、这是一个可选参数。默认值为/opt。




部署此插件后、您应添加 link:task-deploy-snapcenter-plugin-for-sap-hana.html#add-sap-hana-database-hosts["SAP HANA数据库主机。"]



== 手动部署此插件

如果HANA主机上未启用基于SSH密钥的身份验证、则应执行以下手动步骤来部署此插件。

* 步骤 *

. 登录到Connector VM。
. 下载Linux主机插件二进制文件。
`# sudo docker exec -it cloudmanager_scs_cloud curl -X GET 'http://127.0.0.1/deploy/downloadLinuxPlugin'`
. 获取基本挂载路径。`sUdo Docker volume ls | grep SCS_cloud _volume _查｛'print $2'｝_ xargs sudo Docker volume inspect _ grep mountpoint`
. 获取下载插件的二进制路径。`s使用ls <base_mount_path>$(sudo Docker ps|grep -po"cloudmanager_SCS_cloud：.*？"|sed -e 's/*$//'|cut -f2 -d"：")/sc-linux-host-plugin/snapcenter_linux_host_plugin_scs.bin`
. 复制 `snapcenter_linux_host_plugin_scs.bin` 使用scp或其他替代方法访问每个SAP HANA数据库主机。
. 在SAP HANA数据库主机上、运行以下命令为二进制文件启用执行权限。
`chmod +x snapcenter_linux_host_plugin_scs.bin`
. 以sudo SnapCenter 用户身份部署SAP HANA插件。
`./snapcenter_linux_host_plugin_scs.bin -i silent -DSPL_USER=<non-root-user>`
. 复制 `certificate.p12` from `<base_mount_path>/client/certificate/` Connector VM到的路径 `/var/opt/snapcenter/spl/etc/` 在插件主机上。
+
.. 导航到 `/var/opt/snapcenter/spl/etc` 并执行keytool命令以导入证书。
`keytool -v -importkeystore -srckeystore certificate.p12 -srcstoretype PKCS12 -destkeystore keystore.jks -deststoretype JKS -srcstorepass snapcenter -deststorepass snapcenter -srcalias agentcert -destalias agentcert -noprompt`
.. 重新启动SPL：`systemctl restart spl`


. 通过从Connector运行以下命令、验证此插件是否可从Connector访问：
+
`docker exec -it cloudmanager_scs_cloud curl -ik \https://<FQDN or IP of the plug-in host>:<plug-in port>/getVersion --cert /config/client/certificate/certificate.pem --key /config/client/certificate/key.pem`





== 添加SAP HANA数据库主机

您应手动添加SAP HANA数据库主机以分配策略并创建备份。不支持自动发现SAP HANA数据库主机。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击*添加系统*。
. 在*系统详细信息*页面中、执行以下操作：
+
.. 选择系统类型作为多租户数据库容器或单个容器。
.. 输入SAP HANA系统名称。
.. 指定 SAP HANA 系统的 SID 。
.. (可选)指定HDBSQL OS用户。
.. 选择插件主机。(可选)如果未添加主机或要添加多个主机、请单击*添加插件主机*。
.. 如果HANA系统配置了HANA系统复制、请启用* HANA系统复制(HSR)系统*。
.. 单击* HDB安全用户存储密钥*文本框以添加用户存储密钥详细信息。
+
指定密钥名称、系统详细信息、用户名和密码、然后单击*添加密钥*。

+
您可以删除或修改用户存储密钥。



. 单击 * 下一步 * 。
. 在*存储占用空间*页面中、单击*添加存储*并执行以下操作：
+
.. 选择工作环境并指定 NetApp 帐户。
+
转到*画布*页面以添加新的工作环境

.. 选择所需的卷。
.. 单击 * 添加存储 * 。


. 查看所有详细信息、然后单击*添加系统*。



NOTE: 用于查看特定主机的筛选器不起作用。在筛选器中指定主机名时、将显示所有主机

您可以使用REST API修改和删除SAP HANA系统。在删除HANA系统之前、您应删除所有关联的备份并删除保护。



=== 添加非数据卷

添加多租户数据库容器或单个容器类型SAP HANA系统后、您可以添加HANA系统的非数据卷。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击 image:icon-action.png["图标以选择操作"] 对应于要添加非数据卷的系统、然后选择*管理系统*>*非数据卷*。




=== 添加全局非数据卷

添加多租户数据库容器或单个容器类型SAP HANA系统后、您可以添加HANA系统的全局非数据卷。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击*添加系统*。
. 在*系统详细信息*页面中、执行以下操作：
+
.. 从System Type下拉列表中、选择*全局非数据卷*。
.. 输入SAP HANA系统名称。
.. 指定SAP HANA系统的关联SID。
.. 选择插件主机
+
(可选)要添加多个主机、请单击*添加插件主机*并指定主机名和端口、然后单击*添加主机*。

.. 单击 * 下一步 * 。
.. 查看所有详细信息、然后单击*添加系统*。



