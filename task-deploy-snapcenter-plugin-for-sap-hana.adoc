---
sidebar: sidebar 
permalink: task-deploy-snapcenter-plugin-for-sap-hana.html 
keywords: Cloud Manager, BlueXP, SnapCenter Plug-in for SAP HANA, SAP HANA, database, host, deploy 
summary: 在每个SAP HANA数据库主机上安装适用于SAP HANA的SnapCenter 插件。 
---
= 安装适用于SAP HANA的SnapCenter 插件并添加数据库主机
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
您应在每个SAP HANA数据库主机上安装适用于SAP HANA的SnapCenter 插件。根据SAP HANA主机是否启用了基于SSH密钥的身份验证、您可以按照以下方法之一安装此插件。

* 如果为数据库主机启用了SSH、则可以使用SSH选项安装此插件。 <<使用脚本安装此插件,了解更多信息。>>。
* 如果禁用了SSH、请手动安装此插件。 <<手动安装此插件,了解更多信息。>>。




== 前提条件

在添加主机之前、您应确保满足前提条件。

* 确保在每个SAP HANA数据库主机上都安装了Java 11 (64位) Oracle Java或OpenJDK。
* 您应已添加工作环境并创建Connector。
* 确保Connector可连接到SAP HANA数据库主机。
+
有关如何解决连接问题描述 的信息、请参见 link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Cloud_Backup_Application_Failed_to_validate_connectivity_from_BlueXP_connector_host_to_application_database_host["无法验证从BlueXP连接器主机到应用程序数据库主机的连接"]。

+
如果连接器丢失或创建了新连接器、则应将此连接器与现有应用程序资源相关联。有关更新Connector的说明、请参见 link:task-manage-cloud-native-app-data.html#update-the-connector-details["更新连接器详细信息"]。

* 确保BlueXP用户具有"帐户管理员"角色。
* 您应已创建SnapCenter 用户并为非root (sudo)用户配置sudo。有关信息、请参见 link:task-deploy-snapcenter-plugin-for-sap-hana.html#configure-sudo-for-snapcenter-user["为SnapCenter 用户配置sudo。"]
* 在添加数据库主机之前、您应已安装适用于SAP HANA的SnapCenter 插件。
* 在添加SAP HANA数据库主机时、您应添加HDB用户存储密钥。HDB安全用户存储密钥用于将SAP HANA数据库主机的连接信息安全存储在客户端上、而HDBSQL客户端使用安全用户存储密钥连接到SAP HANA数据库主机。
* 对于HANA系统复制(HSR)、要保护HANA系统、您应手动注册主HANA系统和二级HANA系统。
* 如果执行基于SSH的安装、请确保Connector已启用与SSH端口的通信(默认值：22)。
* 确保Connector已启用与插件端口的通信(默认值为8145)、以便数据保护操作正常运行。
* 确保已安装最新版本的插件。要升级此插件、请参见 <<升级适用于SAP HANA数据库的SnapCenter 插件>>。



NOTE: 如果从BlueXP Connector主机到应用程序主机的连接失败、请参见 https://["知识库文章"^] 以了解相关信息。



== 为SnapCenter 用户配置sudo

创建一个非root (sudo)用户以安装此插件。

* 步骤 *

. 登录到Connector VM。
. 复制位于_manager-2_cloudmanager_SCS_cloud_volume/_data/$(sudo docker ps|grep -po"cloudmanager_SCS_cloud：.*？"|sed -e 's/*$//'|cut -f2 -d"：""/sc-linux-host-plugin_
. 使用root用户帐户登录到SAP HANA数据库主机。
. 通过将步骤3中复制的文本复制到_/etc/sudoers.d/snapcenter_文件来为非root用户配置sudo访问权限。
+
在为_/etc/sudoers.d/snapcenter_文件添加的行中、将_snap_替换<LINUXUSER> 为非root用户、将_home/snapcenter_替换<USER_HOME_DIRECTORY> 为_home_sport_<non-root-user>。





== 使用脚本安装此插件

为SAP HANA主机非root用户帐户配置基于SSH密钥的身份验证、并执行以下步骤来安装此插件。

*开始之前*

确保已启用与连接器的SSH连接。

* 步骤 *

. 登录到Connector VM。
. 使用Connector中提供的脚本安装此插件。
`sudo bash  /var/lib/docker/volumes/service-manager-2_cloudmanager_scs_cloud_volume/_data/scripts/linux_plugin_copy_and_install.sh --host <plugin_host> --username <host_user_name> --sshkey <host_ssh_key> --pluginport <plugin_port> --sshport <host_ssh_port>`
+
|===
| Name | Description | 必填 | Default 


 a| 
plugin_host
 a| 
指定SAP HANA主机
 a| 
是的。
 a| 
-



 a| 
host_user_name
 a| 
指定在SAP HANA主机上具有SSH权限的SnapCenter 用户
 a| 
是的。
 a| 
-



 a| 
host_ssh_key
 a| 
指定SnapCenter 用户的SSH密钥、用于连接到SAP HANA主机
 a| 
是的。
 a| 
-



 a| 
plugin_port
 a| 
指定插件使用的端口
 a| 
否
 a| 
8145



 a| 
host_ssh_port
 a| 
指定SAP HANA主机上的SSH端口
 a| 
否
 a| 
22.

|===
+
例如： `sudo bash /var/lib/docker/volumes/service-manager-2_cloudmanager_scs_cloud_volume/_data/scripts/linux_plugin_copy_and_install.sh --host 10.0.1.1 --username snapcenter --sshkey /keys/netapp-ssh.ppk`



安装此插件后、您应执行此操作 <<添加SAP HANA数据库主机>>。



== 手动安装此插件

如果HANA主机上未启用基于SSH密钥的身份验证、则应执行以下手动步骤来安装此插件。

* 步骤 *

. 登录到Connector VM。
. 下载SnapCenter Linux主机插件二进制文件。`sUdo Docker exec -it cloudmanager_SCS_cloud curl -X get 'http://[]
+
此插件二进制文件位于：_cd /var/lib/docker/volumes/service-manager-2_cloudmanager_SCS_cloud_volume/_data/$(sudo docker ps|grep -po"cloudmanager_SCS_cloud：.*？"|sed -e 's/*$//'|cut -f2 -d"：""/sc-linux-host-plugin_

. 使用scp或其他替代方法将每个<non root user (sudo)> 数据库主机的_snapcenter_linux_host_plugin_SCS.bin_从上述路径复制到//home/SAHA/.SC_NetApp_路径。
. 使用非root (sudo)帐户登录到SAP HANA数据库主机。
. 将目录更改为//home/binary/.sc_netapp/_<non root user> 、然后运行以下命令为二进制文件启用执行权限。
`chmod +x snapcenter_linux_host_plugin_scs.bin`
. 以sudo SnapCenter 用户身份安装SAP HANA插件。
`./snapcenter_linux_host_plugin_scs.bin -i silent -DSPL_USER=<non-root>`
. 将_certificate.p12_从Connector VM的_<base_mount_path>/client/certificate/_路径复制到插件主机上的_/var/opt/snapcenter/spl/etc/。
. 导航到_/var/opt/snapcenter/spl/etc_并执行keytool命令以导入证书。`keytool -v -importkeystore -srckeystore certificate.p12 -srcstoretype PKCS12 -destkeystore keystore.jks -deststoretype JKS -srcstorepass SnapCenter -deststorepass SnapCenter -srccalibras agentcert -destalias agentcert -noprop`
. 重新启动SPL：`systemctl restart spl`
. 通过从Connector运行以下命令、验证此插件是否可从Connector访问。
`docker exec -it cloudmanager_scs_cloud curl -ik \https://<FQDN or IP of the plug-in host>:<plug-in port>/PluginService/Version --cert  config/client/certificate/certificate.pem --key /config/client/certificate/key.pem`


安装此插件后、您应执行此操作 <<添加SAP HANA数据库主机>>。



== 升级适用于SAP HANA数据库的SnapCenter 插件

您应升级适用于SAP HANA的SnapCenter 插件数据库、以访问最新的新功能和增强功能。

* 开始之前 *

* 确保主机上未运行任何操作。


* 步骤 *

. 登录到Connector VM。
. 运行以下脚本。
`/var/lib/docker/volumes/service-manager-2_cloudmanager_scs_cloud_volume/_data/scripts/linux_plugin_copy_and_install.sh --host <plugin_host> --username <host_user_name> --sshkey <host_ssh_key> --pluginport <plugin_port> --sshport <host_ssh_port> --upgrade`




== 添加SAP HANA数据库主机

您应手动添加SAP HANA数据库主机以分配策略并创建备份。不支持自动发现SAP HANA数据库主机。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击*添加系统*。
. 在*系统详细信息*页面中、执行以下操作：
+
.. 选择系统类型作为多租户数据库容器或单个容器。
.. 输入SAP HANA系统名称。
.. 指定 SAP HANA 系统的 SID 。
.. (可选)修改HDBSQL操作系统用户。
.. 选择插件主机。(可选)如果未添加主机或要添加多个主机、请单击*添加插件主机*。
.. 如果HANA系统配置了HANA系统复制、请启用* HANA系统复制(HSR)系统*。
.. 单击* HDB安全用户存储密钥*文本框以添加用户存储密钥详细信息。
+
指定密钥名称、系统详细信息、用户名和密码、然后单击*添加密钥*。

+
您可以删除或修改用户存储密钥。



. 单击 * 下一步 * 。
. 在*存储占用空间*页面中、单击*添加存储*并执行以下操作：
+
.. 选择工作环境并指定 NetApp 帐户。
+
转到*画布*页面以添加新的工作环境

.. 选择所需的卷。
.. 单击 * 添加存储 * 。


. 查看所有详细信息、然后单击*添加系统*。



NOTE: 用于查看特定主机的筛选器不起作用。在筛选器中指定主机名时、将显示所有主机。

您可以从用户界面以及使用REST API修改或删除SAP HANA系统。

在删除SAP HANA系统之前、您应删除所有关联的备份并删除此保护。



=== 删除SAP HANA数据库主机

您只能使用REST API删除SAP HANA数据库主机。

* 步骤 *

. 使用用户界面或以下REST API删除与SAP HANA数据库主机关联的所有系统。
`DELETE /saphana/and/systems/(id)`
. 执行以下步骤以删除SAP HANA数据库主机。
+
.. 使用GET REST API获取必须删除的SAP HANA数据库主机的ID。
`GET /saphana/hosts`
   `{`
    `"num_records": 1,`
    `"records": [`
        `{`
            `"id": "c9a6849f-29ea-45c5-a17f-a1e78ad2a30e",`
            `"host_name": "galaxy-vm134.netapp.com",`
            `"port": 443,`
            `"agent_id": "n3TrgkGvnTOFTJJNBxeh3oPxG8AcrcHeclients"`
       
`}`
    `]`
`}`
.. 通过传递以下REST API中的ID来删除SAP HANA数据库主机。
`DELETE /saphana/hosts/(id)`
.. 使用以下命令卸载数据库主机上的SAP HANA Linux插件。
`/opt/NetApp/snapcenter/spl/installation/plugins/uninstall`






=== 添加非数据卷

添加多租户数据库容器或单个容器类型SAP HANA系统后、您可以添加HANA系统的非数据卷。

在发现可用的 SAP HANA 数据库后，您可以将这些资源添加到资源组以执行数据保护操作。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击 image:icon-action.png["图标以选择操作"] 对应于要添加非数据卷的系统、然后选择*管理系统*>*非数据卷*。




=== 添加全局非数据卷

添加多租户数据库容器或单个容器类型SAP HANA系统后、您可以添加HANA系统的全局非数据卷。

* 步骤 *

. 在* BlueXP* UI中、单击*保护*>*备份和恢复*>*应用程序*。
. 单击*发现应用程序*。
. 选择*云原生*>* SAP HANA *、然后单击*下一步*。
. 在*应用程序*页面中、单击*添加系统*。
. 在*系统详细信息*页面中、执行以下操作：
+
.. 从System Type下拉列表中、选择*全局非数据卷*。
.. 输入SAP HANA系统名称。
.. 指定SAP HANA系统的关联SID。
.. 选择插件主机
+
(可选)要添加多个主机、请单击*添加插件主机*并指定主机名和端口、然后单击*添加主机*。

.. 单击 * 下一步 * 。
.. 查看所有详细信息、然后单击*添加系统*。






=== 修改SAP HANA数据库主机

添加SAP HANA数据库主机后、您可以使用REST API修改主机名或插件端口。

* 步骤 *

. 使用GET REST API获取必须删除的SAP HANA数据库主机的ID。 `GET /saphana/hosts`
   `{`
    `"num_records": 1,`
    `"records": [`
        `{`
            `"id": "c9a6849f-29ea-45c5-a17f-a1e78ad2a30e",`
            `"host_name": "galaxy-vm134.netapp.com",`
            `"port": 443,`
            `"agent_id": "n3TrgkGvnTOFTJJNBxeh3oPxG8AcrcHeclients"`
       
`}`
    `]`
`}`
. 使用以下修补程序API修改主机名或插件端口。
`PATCH /saphana/hosts/(id)``

