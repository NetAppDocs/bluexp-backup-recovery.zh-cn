---
sidebar: sidebar 
permalink: br-use-mssql-clone.html 
keywords: backing up, restoring, back up, backup, clone, restore, cloud volumes ontap, aws, azure, s3, blob, google cloud, storagegrid, back up volumes, cloud backup, restore volumes, cost, on-premises ontap, onprem, applications, virtual machines, backup and recovery 
summary: 克隆 Microsoft SQL Server 应用程序数据，用于开发、测试或保护目的。您可以基于即时快照或 Microsoft SQL Server 工作负载的现有快照创建克隆。 
---
= 使用BlueXP backup and recovery克隆 Microsoft SQL Server 工作负载
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
使用BlueXP backup and recovery，将 Microsoft SQL Server 应用程序数据克隆到相同或不同的虚拟机，用于开发、测试或保护目的。您可以从 Microsoft SQL Server 工作负载的即时快照或现有快照创建克隆。

从以下克隆类型中进行选择：

* *即时快照和克隆*：您可以通过即时快照创建 Microsoft SQL Server 工作负载的克隆。即时快照是根据备份创建的源数据的时间点副本。克隆存储在您的公有云或私有云帐户的对象存储中。如果数据丢失或损坏，您可以使用克隆来恢复工作负载。
* *从现有快照克隆*：您可以从工作负载可用的快照列表中选择一个现有快照。如果您想从特定时间点创建克隆，此选项非常有用。克隆到主存储或辅助存储。


您可以实现以下保护目标：

* 创建克隆
* 刷新克隆
* 拆分克隆。
* 删除克隆


*必需的BlueXP角色* 组织管理员、文件夹或项目管理员、备份和恢复超级管理员或备份和恢复克隆管理员角色。  https://docs.netapp.com/us-en/bluexp-setup-admin/reference-iam-predefined-roles.html["了解所有服务的 BlueXP 访问角色"^] 。



== 创建克隆

您可以创建 Microsoft SQL Server 工作负载的克隆。克隆是通过备份创建的源数据的副本。克隆存储在您的公有云或私有云帐户的对象存储中。如果数据丢失或损坏，您可以使用克隆来恢复工作负载。

您可以从现有快照或即时快照创建克隆。即时快照是根据备份创建的源数据的时间点副本。如果数据丢失或损坏，您可以使用克隆来恢复工作负载。

.步骤
. 从BlueXP backup and recovery菜单中，选择 *克隆*。
+
image:screen-br-sql-clone-nomenu.png["BlueXP backup and recovery的克隆页面截图"]

. 选择*创建新克隆*。
. 选择克隆类型：
+
** *从现有快照克隆并刷新数据库*：选择要克隆的快照并配置克隆选项。如果您要选择要克隆的快照并配置选项，这将非常有用。
** *即时快照和克隆*：立即创建源数据的快照，并基于该快照创建克隆。如果您想基于源工作负载中的最新数据创建克隆，此选项非常有用。


. 完成*数据库源*部分：
+
** *单个克隆或批量克隆*：选择创建单个克隆还是多个克隆。如果选择“批量克隆”，则可以使用已创建的保护组一次性创建多个克隆。如果您想为不同的工作负载创建多个克隆，此选项非常有用。
** *源数据库主机、实例和名称*：选择克隆的源数据库主机、实例和名称。源数据库是用于创建克隆的数据库。


. 完成*数据库目标*部分：
+
** *目标数据库主机、实例和名称*：选择克隆的目标数据库主机、实例和名称。目标数据库是克隆创建的位置。
+
（可选）从目标名称下拉列表中选择“*后缀*”，并为克隆的数据库名称附加后缀。如果不指定后缀，则克隆的数据库名称将与源数据库名称相同。

** *QoS（最大吞吐量）*：选择克隆的服务质量 (QoS) 最大吞吐量（以 MBps 为单位）。QoS定义了克隆的性能特征，例如最大吞吐量和 IOPS。


. 完成*Mount*部分：
+
** 自动分配挂载点：选择此选项可自动为克隆分配挂载点。挂载点是克隆在对象存储中挂载的位置。
** *定义挂载点路径*：输入克隆的挂载点。挂载点是克隆在对象存储中挂载的位置。选择驱动器号，输入数据文件路径，并输入日志文件路径。


. 选择 * 下一步 * 。
. 选择还原点：
+
** *现有快照*：从工作负载可用的快照列表中选择一个现有快照。如果您想从特定时间点创建克隆，此选项非常有用。
** *即时快照和克隆*：从工作负载可用的快照列表中选择最新的快照。如果您想从源工作负载中的最新数据创建克隆，此选项非常有用。


. 如果您选择创建*即时快照和克隆*，请选择克隆存储位置：
+
** *本地存储*：选择此选项可在ONTAP系统的本地存储中创建克隆。本地存储是直接连接到ONTAP系统的存储。
** *二级存储*：选择此选项可在ONTAP系统的二级存储中创建克隆。二级存储是用于备份和恢复工作负载的存储。


. 选择数据和日志的目标位置。
. 选择 * 下一步 * 。
. 完成“高级选项”部分：
+
image:screen-br-sql-clone-create-advanced.png["BlueXP backup and recovery中创建克隆的高级设置"]

. 如果您选择*即时快照和克隆*，请完成以下选项：
+
image:screen-br-sql-clone-create-instantsnapshot-advanced.png["BlueXP backup and recovery中创建即时快照和克隆的高级设置"]

+
** *克隆刷新计划和到期日期*：如果您选择*即时克隆*，请输入开始刷新克隆的日期。克隆计划定义了克隆的创建时间。
+
*** *如果计划到期则删除克隆*：如果您想在克隆到期日后删除克隆。
*** *刷新克隆间隔*：选择克隆的刷新频率。您可以选择每小时、每天、每周、每月或每季度刷新一次克隆。如果您希望克隆与源工作负载保持同步，此选项非常有用。


** *前言和后记*：可选地，指定在克隆创建前后运行的克隆前和克隆后脚本。这些脚本可用于执行其他任务，例如配置克隆或发送通知。
** *通知*：（可选）指定用于接收克隆创建状态通知以及作业报告的电子邮件地址。您还可以指定用于接收克隆创建状态通知的 Webhook URL。您可以指定是否需要成功和失败通知，或者仅需要其中一种通知。
** *标签*：选择一个或多个标签，以便您稍后搜索资源组，然后选择*应用*。例如，如果您将“HR”作为标签添加到多个资源组，则稍后可以找到与 HR 标签关联的所有资源组。


. 选择 * 创建 * 。
. 当克隆创建完成后，您可以在*库存*页面中查看它。 image:screen-br-inventory.png["BlueXP backup and recovery的库存页面屏幕截图"]




== 刷新克隆

您可以刷新 Microsoft SQL Server 工作负载的克隆。刷新克隆会使用源工作负载的最新数据更新克隆。如果您想让克隆与源工作负载保持同步，刷新操作非常有用。

您可以选择更改数据库名称、使用最新的即时快照或从现有生产快照刷新。

.步骤
. 从BlueXP backup and recovery菜单中，选择 *克隆*。
. 选择要刷新的克隆。
. 选择“操作”图标image:../media/icon-action.png["操作选项"] > *刷新克隆*。
+
image:screen-br-sql-clone-refresh-options.png["刷新BlueXP backup and recovery的克隆选项"]

. 完成“高级设置”部分：
+
** *恢复范围*：选择恢复所有日志备份还是恢复到特定时间点的日志备份。如果您想将克隆恢复到特定时间点，此选项非常有用。
** *克隆刷新计划和到期日期*：如果您选择*即时克隆*，请输入开始刷新克隆的日期。克隆计划定义了克隆的创建时间。
+
*** *如果计划到期则删除克隆*：如果您想在克隆到期日后删除克隆。
*** *刷新克隆间隔*：选择克隆的刷新频率。您可以选择每小时、每天、每周、每月或每季度刷新一次克隆。如果您希望克隆与源工作负载保持同步，此选项非常有用。


** *iGroup 设置*：选择克隆的 igroup。igroup是用于访问克隆的启动器的逻辑分组。您可以选择现有 igroup，也可以创建新的 igroup。从主 ONTAP 存储系统或辅助ONTAP存储系统中选择 igroup。
** *前言和后记*：可选地，指定在克隆创建前后运行的克隆前和克隆后脚本。这些脚本可用于执行其他任务，例如配置克隆或发送通知。
** *通知*：（可选）指定用于接收克隆创建状态通知以及作业报告的电子邮件地址。您还可以指定用于接收克隆创建状态通知的 Webhook URL。您可以指定是否需要成功和失败通知，或者仅需要其中一种通知。
** *标签*：输入一个或多个标签，方便您稍后搜索资源组。例如，如果您将“HR”作为标签添加到多个资源组，则稍后可以找到与该 HR 标签关联的所有资源组。


. 在刷新确认对话框中，要继续，请选择*刷新*。




== 跳过克隆刷新

如果您不想使用源工作负载中的最新数据来更新克隆，则可能需要跳过克隆刷新。跳过克隆刷新可让您保持克隆的原样，而无需进行更新。

.步骤
. 从BlueXP backup and recovery菜单中，选择 *克隆*。
. 选择您想要跳过刷新的克隆。
. 选择“操作”图标image:../media/icon-action.png["操作选项"] > *跳过刷新*。
. 在“跳过刷新确认”对话框中，执行以下操作：
+
.. 要仅跳过下一个刷新计划，请选择*仅跳过下一个刷新计划*。
.. 要继续，请选择*跳过*。






== 拆分克隆。

您可以拆分 Microsoft SQL Server 工作负载的克隆。拆分克隆会从该克隆创建新的备份。新的备份可用于还原工作负载。

您可以选择将克隆拆分为独立克隆或长期克隆。向导会显示 SVM 的聚合列表、其大小以及克隆卷的所在位置。BlueXPBlueXP backup and recovery还会指示是否有足够的空间来拆分克隆。克隆拆分后，克隆将成为独立的数据库以提供保护。

克隆作业不会被删除，并且可以再次用于其他克隆。

.步骤
. 从BlueXP backup and recovery菜单中，选择 *克隆*。
. 选择一个克隆。
. 选择“操作”图标image:../media/icon-action.png["操作选项"] > *分裂克隆*。
+
image:screen-br-sql-clone-split.png["BlueXP backup and recovery的拆分克隆页面"]

. 查看拆分克隆详细信息并选择*拆分*。
. 当分裂克隆创建完成后，您可以在*库存*页面中查看它。 image:screen-br-inventory.png["BlueXP backup and recovery的库存页面屏幕截图"]




== 删除克隆

您可以删除 Microsoft SQL Server 工作负载的克隆。删除克隆会将其从对象存储中移除，从而释放存储空间。

如果克隆受到策略保护，则会删除该克隆，包括作业。

.步骤
. 从BlueXP backup and recovery菜单中，选择 *克隆*。
. 选择一个克隆。
. 选择“操作”图标image:../media/icon-action.png["操作选项"] > *删除克隆*。
. 在克隆删除确认对话框中，查看删除详细信息。
+
.. 要从SnapCenter中删除克隆的资源，即使无法访问克隆或其存储，也请选择“强制删除”。
.. 选择 * 删除 * 。


. 当克隆被删除时，它将从*库存*页面中删除。

