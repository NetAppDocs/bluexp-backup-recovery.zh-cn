---
sidebar: sidebar 
permalink: concept-ontap-backup-to-cloud.html 
keywords: backing up, restoring, back up, backup, restore, cloud volumes ontap, aws, azure, s3, blob, google cloud, storagegrid, back up volumes, cloud backup, restore volumes, billing, cost, on-premises ontap, onprem 
summary: BlueXP备份和恢复功能可为ONTAP 集群数据提供保护和长期归档功能。备份会自动生成并存储在公有或私有云帐户的对象存储中，而与用于近期恢复或克隆的卷 Snapshot 副本无关。 
---
= 使用BlueXP备份和恢复功能保护ONTAP 集群数据
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
BlueXP备份和恢复功能可为ONTAP 集群数据提供保护和长期归档功能。备份会自动生成并存储在公有或私有云帐户的对象存储中，而与用于近期恢复或克隆的卷 Snapshot 副本无关。

必要时、您可以将整个_volume"、"_folder"或一个或多个_files"从备份还原到相同或不同的工作环境。



== 功能

备份功能：

* 将数据卷的独立副本备份到低成本对象存储。
* 将单个备份策略应用于集群中的所有卷，或者将不同的备份策略分配给具有唯一恢复点目标的卷。
* 创建一个备份策略、以应用于集群中将来创建的所有卷。
* 创建不可变的备份文件、以便在保留期限内对其进行锁定和保护。
* 扫描备份文件以查找可能的勒索软件攻击、并自动删除/替换受感染的备份。
* 将旧备份文件分层到归档存储以节省成本。
* 删除备份关系、以便在保留卷备份的同时归档不需要的源卷。
* 从云备份到云，从内部系统备份到公有或私有云。
* 对于 Cloud Volumes ONTAP 系统，备份可以位于不同的订阅 / 帐户或不同的区域。
* 使用 AES-256 位空闲加密和正在传输的 TLS 1.2 HTTPS 连接保护备份数据。
* 使用您自己的客户管理密钥进行数据加密，而不是使用云提供商提供的默认加密密钥。
* 一个卷最多支持 4 ， 000 个备份。


还原功能：

* 从特定时间点还原数据。
* 将卷、文件夹或单个文件还原到源系统或其他系统。
* 使用不同的订阅 / 帐户或位于不同区域的工作环境还原数据。
* 数据会在块级别进行还原、并将数据直接放置在您指定的位置、同时保留原始ACL。
* 可浏览且可搜索的文件目录、可轻松选择单个文件夹和文件以进行单个文件还原。




== 支持的 ONTAP 工作环境和对象存储提供程序

借助BlueXP备份和恢复功能、您可以将ONTAP 卷从以下工作环境备份到以下公共云和私有云提供商中的对象存储：

[cols="50,50"]
|===
| 源工作环境 | 备份文件目标ifdef：：AWS]] 


| AWS 中的 Cloud Volumes ONTAP | Amazon S3 endif：：AWS]] ifdef：：azure[] 


| Azure 中的 Cloud Volumes ONTAP | Azure Blob endf：：azure[] ifdef：：GCP[] 


| Google 中的 Cloud Volumes ONTAP | Google Cloud Storage endif：gcp[] 


| 内部部署 ONTAP 系统 | ifdef：：：AWS]] Amazon S3 endf：：AWS]] ifdef：：azure[] Azure Blob endf：：azure[] ifdef：：GCP；Google Cloud Storage endf：：GCP；NetApp StorageGRID 
|===
您可以将卷、文件夹或单个文件从ONTAP 备份文件还原到以下工作环境：

[cols="50,50"]
|===
| 备份文件位置 | 目标工作环境ifdef：：AWS]] 


| Amazon S3 | AWS内部部署ONTAP 系统中的Cloud Volumes ONTAP endf：AWS [] ifdef：：azure[] 


| Azure Blob | Azure内部ONTAP 系统中的Cloud Volumes ONTAP endf：azure[] ifdef：：gcp[] 


| Google Cloud 存储 | Google内部部署ONTAP 系统中的Cloud Volumes ONTAP endf：gcp[] 


| NetApp StorageGRID | 内部部署 ONTAP 系统 
|===
请注意， " 内部 ONTAP 系统 " 的引用包括 FAS ， AFF 和 ONTAP Select 系统。



=== 支持连接有限的站点

在互联网连接有限(也称为"受限模式")的站点中、可以使用BlueXP备份和恢复来备份和还原卷数据。在这种情况下、您需要在受限区域部署BlueXP Connector。

ifdef::aws[]

* 您可以将数据从AWS商业区域中安装的Cloud Volumes ONTAP 系统备份到Amazon S3。请参见 link:task-backup-to-s3.html["将 Cloud Volumes ONTAP 数据备份到 Amazon S3"]。


endif::aws[]

ifdef::azure[]

* 您可以将数据从安装在Azure商业区域的Cloud Volumes ONTAP 系统备份到Azure Blob。请参见 link:task-backup-to-azure.html["将Cloud Volumes ONTAP 数据备份到Azure Blob"]。


endif::azure[]



=== 支持无 Internet 连接的站点

在没有Internet连接的站点(也称为"专用模式"或"非公开"站点)中、可以使用BlueXP备份和恢复来备份卷数据。在这种情况下、您需要在非公开站点中部署BlueXP Connector。

* 您可以将本地内部ONTAP 系统中的数据备份到本地NetApp StorageGRID 系统。请参见 link:task-backup-onprem-private-cloud.html["将内部 ONTAP 数据备份到 StorageGRID"] 了解详细信息。ifdef：：AWS。


endif::aws[]

ifdef::azure[]

endif::azure[]



== 支持的卷

BlueXP备份和恢复支持以下类型的卷：

* FlexVol 读写卷
* SnapMirror数据保护(DP)目标卷
* SnapLock 企业卷(需要ONTAP 9.11.1或更高版本)
+
** 目前不支持SnapLock 合规性卷。


* FlexGroup 卷(需要ONTAP 9.12.1或更高版本)


请参见中的章节 <<限制,备份和还原限制>> 了解其他要求和限制。



== 成本

将BlueXP备份和恢复与ONTAP 系统结合使用会产生两种成本：资源费用和服务费用。

* 资源费用 *

向云提供商支付对象存储容量以及向云写入和读取备份文件的资源费用。

* 对于备份，您需要为云提供商支付对象存储成本。
+
由于BlueXP备份和恢复功能可保留源卷的存储效率、因此您需要为data_after_ ONTAP 效率(对于应用重复数据删除和数据压缩后少量的数据)支付云提供商对象存储成本。

* 要使用"搜索和还原"还原数据、某些资源由云提供商配置、搜索请求扫描的数据量会产生每TiB成本。(浏览和还原不需要这些资源。)
+
ifdef::aws[]

+
** 在AWS中、 https://aws.amazon.com/athena/faqs/["Amazon Athena"^] 和 https://aws.amazon.com/glue/faqs/["AWS 胶水"^] 资源部署在新的S3存储分段中。
+
endif::aws[]



+
ifdef::azure[]

+
** 在Azure中、是 https://azure.microsoft.com/en-us/services/synapse-analytics/?&ef_id=EAIaIQobChMI46_bxcWZ-QIVjtiGCh2CfwCsEAAYASAAEgKwjvD_BwE:G:s&OCID=AIDcmm5edswduu_SEM_EAIaIQobChMI46_bxcWZ-QIVjtiGCh2CfwCsEAAYASAAEgKwjvD_BwE:G:s&gclid=EAIaIQobChMI46_bxcWZ-QIVjtiGCh2CfwCsEAAYASAAEgKwjvD_BwE["Azure Synapse工作空间"^] 和 https://azure.microsoft.com/en-us/services/storage/data-lake-storage/?&ef_id=EAIaIQobChMIuYz0qsaZ-QIVUDizAB1EmACvEAAYASAAEgJH5fD_BwE:G:s&OCID=AIDcmm5edswduu_SEM_EAIaIQobChMIuYz0qsaZ-QIVUDizAB1EmACvEAAYASAAEgJH5fD_BwE:G:s&gclid=EAIaIQobChMIuYz0qsaZ-QIVUDizAB1EmACvEAAYASAAEgJH5fD_BwE["Azure数据湖存储"^] 在您的存储帐户中配置以存储和分析数据。
+
endif::azure[]





ifdef::gcp[]

* 在Google中、将部署一个新存储分段、并部署 https://cloud.google.com/bigquery["Google Cloud BigQuery服务"^] 在帐户/项目级别配置。


endif::gcp[]

* 如果您需要从已移至归档存储的备份文件还原卷数据、则云提供商会额外收取每GiB检索费用和每请求费用。


* 服务费用 *

服务费用支付给 NetApp ，用于支付这些备份的 _creation_backup_ 和 _restor_ 卷或文件的费用。您只需为所保护的数据付费，该数据是通过备份到对象存储的 ONTAP 卷的源逻辑已用容量（ _before_ONTAP 效率）计算得出的。此容量也称为前端 TB （前端 TB ）。

有三种方式可以为备份服务付费。第一种选择是从云提供商订阅，这样您可以按月付费。第二种选择是获得年度合同。第三种选择是直接从 NetApp 购买许可证。阅读 <<许可,许可>> 部分以了解详细信息。



== 许可

BlueXP备份和恢复可用于以下使用模式：

* * BYOL*：从NetApp购买的许可证、可用于任何云提供商。
* * PAYGO*：从云提供商的市场按小时订阅。
* *年度*：云提供商市场提供的年度合同。


[NOTE]
====
如果您从NetApp购买BYOL许可证、则还需要从云提供商的市场订阅PAYGO产品。您的许可证始终会先付费，但在以下情况下，您将从市场上的每小时费率中扣除费用：

* 超出许可容量时
* 许可证期限到期时


如果您从某个市场签有年度合同、则所有BlueXP备份和恢复使用量将从该合同中扣除。您不能将年度市场合同与BYOL混合搭配使用。

====


=== 自带许可证

BYOL 基于期限（ 12 ， 24 或 36 个月） _ 和 _ 容量，以 1 TiB 为增量。您需要向 NetApp 支付一段时间（如 1 年）使用此服务的费用，最大容量（如 10 TiB ）。

您将收到一个序列号、您可以在BlueXP数字电子邮件页面中输入此序列号来启用此服务。达到任一限制后，您需要续订许可证。备份 BYOL 许可证适用场景 与关联的所有源系统 https://docs.netapp.com/us-en/cloud-manager-setup-admin/concept-netapp-accounts.html["BlueXP帐户"^]。

link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-byol-license["了解如何管理 BYOL 许可证"]。



=== 按需购买订阅

BlueXP备份和恢复以按需购买模式提供基于消费的许可。通过云提供商的市场订阅后、您可以按GiB为备份的数据付费、无需预先支付费用。您的云提供商会通过每月账单向您开具账单。

link:task-licensing-cloud-backup.html#use-a-bluexp-backup-and-recovery-paygo-subscription["了解如何设置按需购买订阅"]。

请注意、首次注册PAYGO订阅时、您可以获得30天免费试用。



=== 年度合同

ifdef::aws[]

使用AWS时、可以获得两份年期合同、合同期限分别为12、24或36个月：

* 一种" BlueXP备份和恢复"计划、可用于备份Cloud Volumes ONTAP 数据和内部ONTAP 数据。
* 一种"CVO专业人员"计划、可用于捆绑Cloud Volumes ONTAP 和BlueXP备份和恢复。这包括对此许可证付费的 Cloud Volumes ONTAP 卷的无限备份（备份容量不计入此许可证）。


endif::aws[]

ifdef::azure[]

* 使用Azure时、您可以向NetApp申请一项私人优惠、然后在激活BlueXP备份和恢复期间从Azure Marketplace订阅时选择计划。


endif::azure[]

ifdef::gcp[]

* 使用GCP时、您可以向NetApp申请一个私人优惠、然后在激活BlueXP备份和恢复期间从Google Cloud Marketplace订阅时选择计划。


endif::gcp[]

link:task-licensing-cloud-backup.html#use-an-annual-contract["了解如何设置年度合同"]。



== BlueXP备份和恢复的工作原理

在Cloud Volumes ONTAP 或内部部署ONTAP 系统上启用BlueXP备份和恢复时、此服务将对您的数据执行完整备份。备份映像中不包含卷快照。初始备份之后，所有额外备份都是增量备份，这意味着只会备份更改的块和新块。这样可以将网络流量降至最低。BlueXP备份和恢复基于构建 https://docs.netapp.com/us-en/ontap/concepts/snapmirror-cloud-backups-object-store-concept.html["NetApp SnapMirror Cloud技术"^]。


CAUTION: 直接从云提供商环境中执行的任何备份文件管理或更改操作可能会损坏这些文件，并导致配置不受支持。

下图显示了每个组件之间的关系：

image:diagram_cloud_backup_general.png["一个示意图、显示了BlueXP备份和恢复如何与备份文件所在的源系统和目标对象存储上的卷进行通信。"]



=== 备份所在位置

备份副本存储在BlueXP在云帐户中创建的对象存储中。每个集群/工作环境有一个对象存储、BlueXP将该对象存储命名为："netapp-backup-clusteruuid"。请确保不要删除此对象存储。

ifdef::aws[]

* 在AWS中、BlueXP会启用 https://docs.aws.amazon.com/AmazonS3/latest/dev/access-control-block-public-access.html["Amazon S3 块公有访问功能"^] 在 S3 存储分段上。


endif::aws[]

ifdef::azure[]

* 在Azure中、BlueXP使用新的或现有的资源组以及Blob容器的存储帐户。BlueXP https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent["阻止对 Blob 数据的公有访问"] 默认情况下。


endif::azure[]

ifdef::gcp[]

* 在GCP中、BlueXP使用新项目或现有项目、并为Google Cloud Storage存储分段使用存储帐户。


endif::gcp[]

* 在StorageGRID 中、BlueXP会将现有存储帐户用于对象存储分段。


如果您希望将来更改集群的目标对象存储，则需要 link:task-manage-backups-ontap.html#unregistering-bluexp-backup-and-recovery-for-a-working-environment["为工作环境取消注册BlueXP备份和恢复"^]、然后使用新的云提供商信息启用BlueXP备份和恢复。



=== 可自定义的备份计划和保留设置

在为工作环境启用BlueXP备份和恢复时、您最初选择的所有卷都会使用您定义的默认备份策略进行备份。如果要为恢复点目标(RPO)不同的某些卷分配不同的备份策略、您可以为该集群创建其他策略、并在激活BlueXP备份和恢复后将这些策略分配给其他卷。

您可以选择对所有卷进行每小时、每天、每周、每月和每年备份的组合。应用于卷的Snapshot策略必须是BlueXP备份和恢复所识别的策略之一、否则不会创建备份文件。您还可以选择系统定义的策略之一，这些策略可提供 3 个月， 1 年和 7 年的备份和保留期限。这些策略包括：

[cols="35,16,16,16,26"]
|===
| 备份策略名称 3+| 每间隔备份数 ... | 最大备份 


|  | * 每日 * | * 每周 * | * 每月 * |  


| NetApp 3 个月保留 | 30 个 | 13 | 3. | 46 


| NetApp 保留 1 年 | 30 个 | 13 | 12 | 55 


| NetApp 7 年保留 | 30 个 | 53. | 84. | 167. 
|===
使用 ONTAP 系统管理器或 ONTAP 命令行界面在集群上创建的备份保护策略也会显示为选项。其中包括使用自定义SnapMirror标签创建的策略。

达到某个类别或间隔的最大备份数后、较早的备份将被删除、以便始终拥有最新的备份(因此废弃的备份不会继续占用云中的空间)。

请参见 link:concept-cloud-backup-policies.html#backup-schedules["备份计划"^] 有关如何使用可用计划选项的更多详细信息。

请注意，您可以 link:task-manage-backups-ontap.html#creating-a-manual-volume-backup-at-any-time["创建卷的按需备份"] 除了从计划的备份创建的备份文件之外，还可以随时从备份信息板访问这些备份文件。


TIP: 数据保护卷备份的保留期限与源 SnapMirror 关系中定义的保留期限相同。您可以根据需要使用 API 更改此设置。



=== 备份文件保护设置

如果您的集群使用的是ONTAP 9.11.1或更高版本、您可以保护备份免受删除和勒索软件攻击。每个备份策略都为_DataLock和勒索软件保护_提供了一个部分、可在特定时间段(_retention period_)内应用于备份文件。_DataLock_可防止您的备份文件被修改或删除。_勒索 软件保护_扫描您的备份文件、以查找创建备份文件以及还原备份文件中的数据时发生勒索软件攻击的证据。

备份保留期限与备份计划保留期限相同；加上14天。例如、保留了_5_副本的_weekly_备份会将每个备份文件锁定5周。保留了_6_副本的_monthly备份将锁定每个备份文件6个月。

如果您的备份目标为Amazon S3、Azure Blob或NetApp StorageGRID 、则当前可以获得支持。其他存储提供程序目标将在未来版本中添加。

请参见 link:concept-cloud-backup-policies.html#datalock-and-ransomware-protection["DataLock和勒索软件保护"^] 有关DataLock和勒索软件保护的工作原理的更多详细信息。


TIP: 如果要将备份分层到归档存储、则无法启用DataLock。



=== 旧备份文件的归档存储

使用特定云存储时、您可以在一定天数后将旧备份文件移至成本较低的存储类/访问层。请注意、如果已启用DataLock、则无法使用归档存储。

ifdef::aws[]

* 在 AWS 中，备份从 _Standard_ 存储类开始，并在 30 天后过渡到 _Standard-Infrequent Access_ 存储类。
+
如果您的集群使用的是ONTAP 9.10.1或更高版本、则可以选择在一定天数后在BlueXP备份和恢复UI中将旧备份分层到_S3 Glacer_或_S3 Glacier Deep Archive_存储、以进一步优化成本。 link:reference-aws-backup-tiers.html["了解有关 AWS 归档存储的更多信息"^]。



endif::aws[]

ifdef::azure[]

* 在 Azure 中，备份与 _cool_ 访问层关联。
+
如果集群使用的是ONTAP 9.10.1或更高版本、则可以选择在经过一定天数后在BlueXP备份和恢复UI中将旧备份分层到_Azure Archive_存储、以进一步优化成本。 link:reference-azure-backup-tiers.html["详细了解 Azure 归档存储"^]。



endif::azure[]

ifdef::gcp[]

* 在 GCP 中，备份与 _Standard_ 存储类关联。
+
如果集群使用的是ONTAP 9.12.1或更高版本、则可以选择在经过一定天数后在BlueXP备份和恢复UI中将旧备份分层到_Archive_存储、以进一步优化成本。 link:reference-google-backup-tiers.html["了解有关Google归档存储的更多信息"^]。



endif::gcp[]

* 在 StorageGRID 中，备份与 _Standard_ 存储类关联。
+
如果您的内部集群使用的是ONTAP 9.12.1或更高版本、而您的StorageGRID 系统使用的是11.4或更高版本、则可以在一定天数后将旧备份文件归档到公共云归档存储。目前支持AWS S3 Glacer/S3 Glacier深度归档或Azure归档存储层。 link:task-backup-onprem-private-cloud.html#preparing-to-archive-older-backup-files-to-public-cloud-storage["了解有关从StorageGRID 归档备份文件的更多信息"^]。



请参见 link:concept-cloud-backup-policies.html#archival-storage-settings["归档存储设置"] 有关归档旧备份文件的更多详细信息。



== FabricPool 分层策略注意事项

当您要备份的卷位于 FabricPool 聚合上且其分配的策略不是 `none` 时，您需要注意以下几点：

* FabricPool 分层卷的首次备份要求读取所有本地数据和所有分层数据（从对象存储）。备份操作不会 " 重新加热 " 对象存储中分层的冷数据。
+
此操作可能发生原因会一次性增加从云提供商读取数据的成本。

+
** 后续备份是增量备份，不会产生这种影响。
** 如果在最初创建卷时为其分配了分层策略，则不会显示此问题描述。


* 在分配之前、请考虑备份的影响 `all` 将策略分层到卷。由于数据会立即分层、因此、BlueXP备份和恢复将从云层而非本地层读取数据。由于并发备份操作会共享指向云对象存储的网络链路，因此，如果网络资源饱和，性能可能会下降。在这种情况下，您可能需要主动配置多个网络接口（ LIF ）以降低此类网络饱和。




== 限制



=== 备份限制

* 在创建或编辑备份策略时，如果没有为该策略分配任何卷，则保留的备份数最多可以为 1018 。为策略分配卷后、您可以编辑此策略以创建多达4000个备份。
* 备份数据保护(DP)卷时：
+
** 与SnapMirror标签`APP_consistent`和`all_source_snapshot`的关系不会备份到云。
** 如果在SnapMirror目标卷上创建Snapshot的本地副本(无论使用的SnapMirror标签如何)、则这些Snapshot不会作为备份移动到云中。此时、您需要为源DP卷创建一个包含所需标签的Snapshot策略、以便BlueXP备份和恢复功能对其进行备份。


* FlexGroup 卷备份无法移动到归档存储、也无法使用DataLock和勒索软件保护。
* 支持 SVM-DR 卷备份，但有以下限制：
+
** 仅支持从 ONTAP 二级系统进行备份。
** 应用于卷的Snapshot策略必须是BlueXP备份和恢复所识别的策略之一、包括每日、每周、每月等 无法识别默认的"sm_created"策略(用于*镜像所有快照*)、并且DP卷不会显示在可备份的卷列表中。




* MetroCluster 支持：
+
** 使用ONTAP 9.12.1 GA或更高版本时、如果连接到主系统、则支持备份。整个备份配置将传输到二级系统、以便在切换后自动继续备份到云。您无需在二级系统上设置备份(实际上、您会受到限制)。
** 使用ONTAP 9.12.0及更早版本时、仅支持从ONTAP 二级系统进行备份。
** 目前不支持FlexGroup 卷的备份。


* 数据保护卷不支持使用*立即备份*按钮进行临时卷备份。
* 不支持 SM-BC 配置。
* ONTAP 不支持扇出从一个卷到多个对象存储的SnapMirror关系；因此、BlueXP备份和恢复不支持此配置。
* 目前、Amazon S3、Azure和StorageGRID 支持对象存储上的WORM/Compliance模式。这称为DataLock功能、必须使用BlueXP备份和恢复设置进行管理、而不是使用云提供商界面。




=== 还原限制

这些限制适用于恢复文件和文件夹的搜索和还原以及浏览和还原方法；除非特别说明。

* 浏览和还原一次最多可还原100个单个文件。
* 搜索和还原一次可以还原1个文件。
* 使用ONTAP 9.13.0或更高版本时、浏览和还原以及搜索和还原可以还原文件夹及其所有文件和子文件夹。
+
如果使用的ONTAP 版本高于9.11.1、但低于9.13.0、则还原操作只能还原选定文件夹、并且该文件夹中的文件不会还原子文件夹或子文件夹中的文件。

+
如果使用的ONTAP 版本早于9.11.1、则不支持文件夹还原。

* FlexGroup 卷当前不支持目录/文件夹还原。
* 如果备份文件驻留在归档存储中、则无法还原单个文件夹。
* 不支持从FlexGroup 卷还原到FlexVol 卷、或将FlexVol 卷还原到FlexGroup 卷。
* 要还原的文件必须使用与目标卷上的语言相同的语言。如果语言不同，您将收到一条错误消息。
* 将数据从Azure归档存储还原到StorageGRID 系统时、不支持_High_还原优先级。

